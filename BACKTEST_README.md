# 윌리엄 오닐 돌파매매 백테스트 시스템

## 📖 개요

윌리엄 오닐의 CAN SLIM 전략을 기반으로 한 백테스트 시스템입니다.
- 컵앤핸들 패턴
- 피벗 포인트 돌파
- 베이스 돌파

## 🚀 빠른 시작

### 1. 미국 주식 백테스트
```python
python oneil_backtest.py
# 선택: 1
```

### 2. 한국 주식 백테스트
```python
python oneil_backtest.py
# 선택: 2
```

## ⚙️ 커스텀 설정

`custom_backtest()` 함수를 수정하여 원하는 설정으로 백테스트 가능:

```python
INITIAL_CAPITAL = 10000000  # 초기 자본
MARKET = 'US'  # 'US' 또는 'KR'
TICKERS = ['AAPL', 'MSFT', 'GOOGL']  # 종목 리스트
START_DATE = '2023-01-01'  # 시작일
END_DATE = '2024-12-31'  # 종료일
PATTERNS = ['pivot', 'base']  # 테스트할 패턴
```

## 📊 주요 기능

### 1. 패턴 감지
- **컵앤핸들**: 12-40% 깊이의 컵, 12% 미만 핸들
- **피벗돌파**: 20일 저항선 돌파 + 50% 이상 거래량 증가
- **베이스돌파**: 횡보 후 돌파 + 40% 이상 거래량 증가

### 2. 리스크 관리
- **손절**: 매수가 -8%
- **익절**: 매수가 +20%
- **최대 보유**: 30일
- **포지션 크기**: 자본의 20% (최대 5개 종목)

### 3. 성과 지표
- 총 수익률
- 승률
- 평균 수익/손실
- 최대 수익/손실
- 패턴별 성과
- 개별 거래 내역

## 📈 출력 예시

```
📊 백테스트 성과 보고서
============================================================

💰 자본
   초기 자본:         10,000,000원
   최종 자본:         11,250,000원
   총 수익:            1,250,000원
   수익률:                   12.50%

📈 거래 통계
   총 거래:                     25건
   수익 거래:                   16건
   손실 거래:                    9건
   승률:                       64.00%

💵 수익/손실
   평균 수익:                  8.50%
   평균 손실:                 -6.20%
   최대 수익:                 25.30%
   최대 손실:                 -8.00%

⏱️  보유 기간
   평균:                      12.5일

📊 패턴별 성과
패턴          거래수     평균수익      승률
----------------------------------------
컵앤핸들          10건      7.20%    70.0%
피벗돌파           8건      9.50%    62.5%
베이스돌파         7건      6.80%    57.1%
```

## 💾 결과 저장

백테스트 결과는 자동으로 CSV 파일로 저장됩니다:
- `us_backtest_results.csv` - 미국 주식 결과
- `kr_backtest_results.csv` - 한국 주식 결과
- `custom_backtest_results.csv` - 커스텀 결과

CSV 파일 포함 내용:
- 종목, 패턴, 진입/청산 날짜/가격
- 수익/수익률, 보유 기간
- 청산 사유 (손절/익절/기간만료)

## 🔧 코드에서 직접 사용

```python
from oneil_backtest import BacktestEngine

# 엔진 초기화
engine = BacktestEngine(initial_capital=10000000)

# 단일 종목 백테스트
engine.run_backtest(
    ticker='AAPL',
    start_date='2023-01-01',
    end_date='2024-12-31',
    market='US',
    patterns=['cup', 'pivot', 'base']
)

# 다중 종목 백테스트
engine.run_portfolio_backtest(
    tickers=['AAPL', 'MSFT', 'NVDA'],
    start_date='2023-01-01',
    end_date='2024-12-31',
    market='US',
    patterns=['pivot', 'base']
)

# 결과 출력
engine.print_performance_report()

# 결과 저장
engine.save_results('my_backtest.csv')
```

## 📝 패턴 선택

원하는 패턴만 테스트하려면:
```python
patterns=['cup']           # 컵앤핸들만
patterns=['pivot']         # 피벗돌파만
patterns=['base']          # 베이스돌파만
patterns=['pivot', 'base'] # 피벗 + 베이스
patterns=['cup', 'pivot', 'base']  # 모든 패턴 (기본값)
```

## 🎯 최적화 팁

1. **기간 선택**: 최소 1년, 권장 2-3년
2. **종목 선택**: 유동성 높은 대형주 추천
3. **패턴 조합**: 여러 패턴을 함께 테스트하여 비교
4. **자본 배분**: 기본 20%/종목, 필요시 코드에서 수정 가능

## ⚠️ 주의사항

1. **과거 성과는 미래를 보장하지 않습니다**
2. 백테스트는 슬리피지, 수수료 미포함
3. 실제 거래 시 시장 상황과 심리적 요인 고려 필요
4. 백테스트 결과를 참고용으로만 활용하세요

## 📚 추가 정보

- 윌리엄 오닐 저서: "How to Make Money in Stocks"
- CAN SLIM 전략에 대한 추가 학습 권장
- 실전 투자 전 충분한 연습과 공부 필요

## 🐛 문제 해결

### 데이터 조회 오류
- yfinance 또는 pykrx 라이브러리 업데이트
- 인터넷 연결 확인
- 종목 코드 확인 (미국: 티커, 한국: 6자리 코드)

### 메모리 오류
- 종목 수 줄이기
- 백테스트 기간 단축
- 한 번에 하나의 시장만 테스트
