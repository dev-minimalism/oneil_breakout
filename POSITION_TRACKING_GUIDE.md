# 🎯 윌리엄 오닐 포지션 자동 추적 봇 - 사용 가이드

## ✨ 새로운 기능: 자동 포지션 추적

매수 신호가 발생하면 자동으로 포지션을 기록하고, 손절/익절 시점을 추적하여 알림을 보냅니다!

## 📋 주요 기능

### 1. **자동 포지션 기록**
매수 신호 발생 시:
```
✅ AAPL 피벗돌파 신호!
📝 포지션 추가: AAPL @ 150.00
```
→ 자동으로 `positions.json` 파일에 저장

### 2. **자동 포지션 추적**
30분마다 스캔할 때 보유 포지션 체크:
```
📊 포지션 추적 중... (3개)
  🔍 AAPL: 155.00 (+3.33%) ⚪
  🔍 MSFT: 368.00 (-8.50%) ⚠️ 손절!
  🔍 NVDA: 540.00 (+21.00%) ✅ 익절!
```

### 3. **자동 청산 알림**

#### 손절 (-8%)
```
🇺🇸 [포지션 청산]

🏢 종목: MSFT
📊 패턴: 피벗돌파
💰 진입가: 400.00
💵 청산가: 368.00
📉 수익률: -8.00%
📅 보유기간: 5일

🔔 사유: 손절 (-8%)
```

#### 익절 (+20%)
```
🇺🇸 [포지션 청산]

🏢 종목: NVDA
📊 패턴: 컵앤핸들
💰 진입가: 450.00
💵 청산가: 540.00
📈 수익률: +20.00%
📅 보유기간: 12일

🔔 사유: 익절 (+20%)
```

#### 보유기간 만료 (30일)
```
🇺🇸 [포지션 청산]

🏢 종목: AAPL
📊 패턴: 베이스돌파
💰 진입가: 150.00
💵 청산가: 155.00
📈 수익률: +3.33%
📅 보유기간: 30일

🔔 사유: 보유기간 만료 (30일)
```

## 💬 새로운 명령어

### `/positions` - 현재 포지션 보기
```
📊 현재 포지션 (3개)

1. 🇺🇸 AAPL
   진입: 150.00
   현재: 155.00 (📈+3.33%)
   패턴: 피벗돌파
   보유: 7일
   손절: 138.00
   익절: 180.00

2. 🇰🇷 삼성전자
   진입: 70000
   현재: 72000 (📈+2.86%)
   패턴: 컵앤핸들
   보유: 3일
   손절: 64400
   익절: 84000
```

### `/close [티커]` - 수동 청산
```
/close AAPL
→ ✅ AAPL 포지션이 청산되었습니다.
```

## 🔄 자동 추적 규칙

### 진입
- 매수 신호 발생 시 **자동으로 포지션 기록**
- 같은 종목 중복 진입 방지

### 청산 조건 (자동)
1. **손절**: 진입가 대비 -8%
2. **익절**: 진입가 대비 +20%
3. **기간 만료**: 30일 경과

### 추적 주기
- 30분마다 자동 스캔 시 체크
- 휴장 시간에도 포지션 추적 가능

## 📁 파일 구조

### `positions.json` (자동 생성)
```json
{
  "positions": [
    {
      "ticker": "AAPL",
      "market": "US",
      "entry_price": 150.00,
      "entry_date": "2025-10-31 10:30:00",
      "pattern": "피벗돌파",
      "stop_loss": 138.00,
      "take_profit": 180.00,
      "signal": {...}
    }
  ],
  "updated_at": "2025-10-31 15:00:00"
}
```

### `watchlist.json` (기존)
감시 종목 저장

## 🚀 시작하기

### 1. 봇 실행
```bash
python oneil_breakout_bot_smart_with_positions.py
```

### 2. 감시 종목 추가
```
/add_us AAPL
/add_kr 005930
```

### 3. 매수 신호 대기
봇이 자동으로 스캔하고 신호 발생 시:
- 텔레그램 알림
- 포지션 자동 기록

### 4. 포지션 확인
```
/positions
```

### 5. 청산 알림 받기
손절/익절/기간 만료 시 자동 알림!

## 💡 팁

### 중복 진입 방지
같은 종목에 이미 포지션이 있으면 새 신호가 발생해도 추가 진입하지 않음

### 수동 청산
```
/close AAPL
```
자동 청산을 기다리지 않고 원할 때 청산 가능

### 포지션 현황 파악
```
/positions
```
현재가와 수익률을 실시간으로 확인

### 파일 백업
`positions.json`을 주기적으로 백업하면 안전

## ⚠️ 주의사항

### 1. 가상 포지션
- 실제 매수/매도가 아님
- 신호 추적 및 분석용

### 2. 수동 매매 필요
- 봇은 알림만 제공
- 실제 거래는 직접 수행

### 3. 시세 지연
- 실시간이 아닌 최근 종가 기준
- 정확한 가격은 거래소에서 확인

### 4. 파일 관리
- `positions.json` 삭제 시 포지션 정보 손실
- 백업 권장

## 📊 활용 예시

### 시나리오 1: 단기 트레이딩
```
1. 아침에 /scan_kr → NAVER 신호 발생
2. 포지션 자동 추가
3. 5일 후 +20% 도달 → 익절 알림
4. 실제로 매도 실행
```

### 시나리오 2: 손절 관리
```
1. AAPL 매수 신호 발생
2. 포지션 기록됨
3. 2일 후 -8% 도달 → 손절 알림
4. 빠르게 손절 실행
```

### 시나리오 3: 포트폴리오 관리
```
1. 여러 종목 신호 발생
2. /positions로 전체 포지션 확인
3. 수익률 모니터링
4. 전략적 청산 결정
```

## 🔧 문제 해결

### 포지션이 추가 안 됨
- 같은 종목에 이미 포지션이 있는지 확인
- `/positions` 명령어로 확인

### 청산 알림이 안 옴
- 봇이 실행 중인지 확인
- 30분 주기로 체크하므로 시간 소요 가능

### 포지션 정보 손실
- `positions.json` 파일 확인
- 없으면 백업에서 복원

## 📚 추가 기능

### 기존 기능 유지
- 시간대별 자동 스캔
- 텔레그램 명령어로 종목 관리
- 즉시 스캔 (`/scan`, `/scan_kr`, `/scan_us`)

### 새로 추가된 기능
- ✨ 자동 포지션 추적
- ✨ 손절/익절 자동 알림
- ✨ 포지션 관리 명령어

## 🎯 정리

이제 매수 신호만 받는 것이 아니라:
1. **자동 포지션 기록**
2. **실시간 추적**
3. **청산 타이밍 알림**

완전 자동으로 관리됩니다! 🚀

---

**행복한 투자 되세요!** 📈
